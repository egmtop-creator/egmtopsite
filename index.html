<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Playtime Factory</title>
<style>
body { margin:0; overflow:hidden; background:black; color:white; font-family:Arial; }
#menu, #death, #ending, #introScreen {
 position:absolute; width:100%; height:100%;
 display:flex; flex-direction:column;
 justify-content:center; align-items:center;
 background:black; z-index:10;
}
h1 { color:red; font-size:60px; text-shadow:0 0 30px red; }
button {
 padding:15px 40px; margin:10px;
 background:black; color:red;
 border:2px solid red; font-size:20px;
 cursor:pointer;
}
button:hover { background:red; color:black; }
#death, #ending, #introScreen { display:none; }
canvas { display:block; }
.vhs {
 animation: glitch 0.2s infinite;
}
@keyframes glitch {
 0%{opacity:1;}
 50%{opacity:0.9;}
 100%{opacity:1;}
}
</style>
</head>
<body>

<div id="menu">
<h1>PLAYTIME CO.</h1>
<button onclick="startIntro()">PLAY</button>
</div>

<div id="introScreen" class="vhs">
<h1>WELCOME TO PLAYTIME CO.</h1>
<p>Everyone thinks the staff disappeared 10 years ago...</p>
<button onclick="startGame()">ENTER FACTORY</button>
</div>

<div id="death"><h1>YOU DIED</h1></div>
<div id="ending"><h1>POPPY: You opened my case...</h1></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
let scene,camera,renderer;
let move={w:false,s:false,a:false,d:false};
let huggy, door, keyCard, puzzleButton;
let hasKey=false;
let puzzleSolved=false;
let chase=false;

function startIntro(){
 document.getElementById("menu").style.display="none";
 document.getElementById("introScreen").style.display="flex";
}

function startGame(){
 document.getElementById("introScreen").style.display="none";

 scene=new THREE.Scene();
 scene.fog=new THREE.Fog(0x000000,5,70);

 camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
 camera.position.set(0,2,5);

 renderer=new THREE.WebGLRenderer();
 renderer.setSize(innerWidth,innerHeight);
 document.body.appendChild(renderer.domElement);

 let light=new THREE.PointLight(0xff0000,2,30);
 light.position.set(0,5,0);
 scene.add(light);
 scene.add(new THREE.AmbientLight(0x111111));

 // Пол
 let floor=new THREE.Mesh(
  new THREE.PlaneGeometry(20,200),
  new THREE.MeshStandardMaterial({color:0x222222})
 );
 floor.rotation.x=-Math.PI/2;
 scene.add(floor);

 // Стены
 let wallMat=new THREE.MeshStandardMaterial({color:0x111111});
 for(let i=-100;i<100;i+=10){
   let left=new THREE.Mesh(new THREE.BoxGeometry(1,5,10),wallMat);
   left.position.set(-10,2.5,i);
   scene.add(left);
   let right=new THREE.Mesh(new THREE.BoxGeometry(1,5,10),wallMat);
   right.position.set(10,2.5,i);
   scene.add(right);
 }

 // Ключ-карта
 keyCard=new THREE.Mesh(
   new THREE.BoxGeometry(1,0.5,0.1),
   new THREE.MeshStandardMaterial({color:0x00ff00})
 );
 keyCard.position.set(5,1,-15);
 scene.add(keyCard);

 // Дверь
 door=new THREE.Mesh(
   new THREE.BoxGeometry(4,6,1),
   new THREE.MeshStandardMaterial({color:0x550000})
 );
 door.position.set(0,3,-40);
 scene.add(door);

 // Электро-панель
 puzzleButton=new THREE.Mesh(
   new THREE.BoxGeometry(2,2,0.5),
   new THREE.MeshStandardMaterial({color:0xffff00})
 );
 puzzleButton.position.set(-5,2,-25);
 scene.add(puzzleButton);

 // Huggy
 huggy=new THREE.Mesh(
   new THREE.BoxGeometry(2,4,2),
   new THREE.MeshStandardMaterial({color:0x0000ff})
 );
 huggy.position.set(0,2,-80);
 scene.add(huggy);

 document.addEventListener("keydown",e=>move[e.key.toLowerCase()]=true);
 document.addEventListener("keyup",e=>move[e.key.toLowerCase()]=false);
 document.body.requestPointerLock();
 document.addEventListener("mousemove",mouseMove);
 document.addEventListener("click",interact);

 animate();
}

function mouseMove(e){
 if(document.pointerLockElement===document.body){
  camera.rotation.y-=e.movementX*0.002;
  camera.rotation.x-=e.movementY*0.002;
 }
}

function interact(){
 if(camera.position.distanceTo(keyCard.position)<3){
   hasKey=true;
   scene.remove(keyCard);
 }
 if(camera.position.distanceTo(puzzleButton.position)<3){
   puzzleSolved=true;
   puzzleButton.material.color.set(0x00ff00);
 }
}

function animate(){
 requestAnimationFrame(animate);

 let speed=0.2;
 if(move.w) camera.translateZ(-speed);
 if(move.s) camera.translateZ(speed);
 if(move.a) camera.translateX(-speed);
 if(move.d) camera.translateX(speed);

 // Открытие двери
 if(hasKey && puzzleSolved && camera.position.distanceTo(door.position)<5){
   door.position.y+=0.05;
 }

 // Запуск погони
 if(camera.position.z<-50 && !chase){
   chase=true;
 }

 if(chase){
   huggy.position.z+=0.3;
 }

 // Скример
 if(huggy.position.distanceTo(camera.position)<2){
   document.getElementById("death").style.display="flex";
 }

 // Концовка
 if(camera.position.z<-90){
   document.getElementById("ending").style.display="flex";
 }

 renderer.render(scene,camera);
}
</script>
</body>
</html>
