<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Playtime Factory — Single HTML</title>
<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial; color:white; }
canvas { display:block; }

/* Экраны */
.screen {
 position:absolute; inset:0;
 display:flex; flex-direction:column;
 justify-content:center; align-items:center;
 background:black; z-index:20;
}
h1 { color:red; font-size:60px; text-shadow:0 0 30px red; margin:10px; }
button {
 padding:15px 40px; margin:10px;
 background:black; color:red;
 border:2px solid red; font-size:20px;
 cursor:pointer;
}
button:hover { background:red; color:black; }

#introText { animation: glitch 0.15s infinite; }
@keyframes glitch {
 0%{opacity:1;}
 50%{opacity:0.85;}
 100%{opacity:1;}
}

#hud {
 position:absolute; bottom:20px; width:100%;
 text-align:center; font-size:22px;
 text-shadow:0 0 10px red; z-index:5;
}

#crosshair {
 position:absolute; top:50%; left:50%;
 width:10px; height:10px;
 margin-left:-5px; margin-top:-5px;
 border:2px solid white; z-index:5;
}
</style>
</head>
<body>

<div id="menu" class="screen">
<h1>PLAYTIME CO.</h1>
<button onclick="startIntro()">PLAY</button>
</div>

<div id="intro" class="screen" style="display:none;">
<h1 id="introText">WELCOME BACK.</h1>
<p>We are still here.</p>
<button onclick="startGame()">ENTER FACTORY</button>
</div>

<div id="death" class="screen" style="display:none;">
<h1>YOU DIED</h1>
<button onclick="location.reload()">RESTART</button>
</div>

<div id="ending" class="screen" style="display:none;">
<h1>Poppy: You opened my case...</h1>
<p>Now we are free.</p>
<button onclick="location.reload()">PLAY AGAIN</button>
</div>

<div id="hud"></div>
<div id="crosshair"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
let scene,camera,renderer;
let move={w:false,s:false,a:false,d:false};
let keyCard,door,panel,huggy;
let hasKey=false;
let powerOn=false;
let chase=false;
let storyStage=0;

function startIntro(){
 document.getElementById("menu").style.display="none";
 document.getElementById("intro").style.display="flex";
}

function startGame(){
 document.getElementById("intro").style.display="none";

 scene=new THREE.Scene();
 scene.fog=new THREE.Fog(0x000000,5,80);

 camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
 camera.position.set(0,2,5);

 renderer=new THREE.WebGLRenderer();
 renderer.setSize(innerWidth,innerHeight);
 document.body.appendChild(renderer.domElement);

 const light=new THREE.PointLight(0xff0000,2,30);
 light.position.set(0,5,0);
 scene.add(light);
 scene.add(new THREE.AmbientLight(0x111111));

 const floor=new THREE.Mesh(
  new THREE.PlaneGeometry(20,200),
  new THREE.MeshStandardMaterial({color:0x222222})
 );
 floor.rotation.x=-Math.PI/2;
 scene.add(floor);

 const wallMat=new THREE.MeshStandardMaterial({color:0x111111});
 for(let i=-100;i<100;i+=10){
   let left=new THREE.Mesh(new THREE.BoxGeometry(1,5,10),wallMat);
   left.position.set(-10,2.5,i);
   scene.add(left);
   let right=new THREE.Mesh(new THREE.BoxGeometry(1,5,10),wallMat);
   right.position.set(10,2.5,i);
   scene.add(right);
 }

 keyCard=new THREE.Mesh(
   new THREE.BoxGeometry(1,0.5,0.1),
   new THREE.MeshStandardMaterial({color:0x00ff00})
 );
 keyCard.position.set(5,1,-15);
 scene.add(keyCard);

 panel=new THREE.Mesh(
   new THREE.BoxGeometry(2,2,0.5),
   new THREE.MeshStandardMaterial({color:0xffff00})
 );
 panel.position.set(-5,2,-25);
 scene.add(panel);

 door=new THREE.Mesh(
   new THREE.BoxGeometry(4,6,1),
   new THREE.MeshStandardMaterial({color:0x550000})
 );
 door.position.set(0,3,-40);
 scene.add(door);

 huggy=new THREE.Mesh(
   new THREE.BoxGeometry(2,4,2),
   new THREE.MeshStandardMaterial({color:0x0000ff})
 );
 huggy.position.set(0,2,-80);
 scene.add(huggy);

 document.addEventListener("keydown",e=>move[e.key.toLowerCase()]=true);
 document.addEventListener("keyup",e=>move[e.key.toLowerCase()]=false);
 document.addEventListener("mousemove",mouseMove);
 document.addEventListener("click",interact);
 document.body.requestPointerLock();

 animate();
}

function mouseMove(e){
 if(document.pointerLockElement===document.body){
  camera.rotation.y-=e.movementX*0.002;
  camera.rotation.x-=e.movementY*0.002;
 }
}

function interact(){
 if(camera.position.distanceTo(keyCard.position)<3){
   hasKey=true;
   scene.remove(keyCard);
   hud("Key card acquired.");
 }
 if(camera.position.distanceTo(panel.position)<3){
   powerOn=true;
   panel.material.color.set(0x00ff00);
   hud("Power restored.");
 }
}

function hud(text){
 document.getElementById("hud").innerText=text;
 setTimeout(()=>{document.getElementById("hud").innerText="";},3000);
}

function animate(){
 requestAnimationFrame(animate);

 let speed=0.2;
 if(chase) speed=0.35;

 if(move.w) camera.translateZ(-speed);
 if(move.s) camera.translateZ(speed);
 if(move.a) camera.translateX(-speed);
 if(move.d) camera.translateX(speed);

 if(hasKey && powerOn && camera.position.distanceTo(door.position)<5){
   door.position.y+=0.05;
 }

 if(camera.position.z<-50 && !chase){
   chase=true;
   hud("RUN.");
 }

 if(chase){
   huggy.lookAt(camera.position);
   huggy.position.z+=0.4;
 }

 if(huggy.position.distanceTo(camera.position)<2){
   document.getElementById("death").style.display="flex";
 }

 if(camera.position.z<-95){
   document.getElementById("ending").style.display="flex";
 }

 renderer.render(scene,camera);
}
</script>
</body>
</html>
